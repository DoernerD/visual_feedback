<launch>

    <!-- Configurable arguments -->
    <arg name="robot_name" default="sam"/>

    <arg name="loop_freq" default="20."/>
    <arg name="verbose_arg" default="True"/>

    <!-- topics, note the root! -->
    <arg name="state_feedback_topic" default="/$(arg robot_name)/dr/odom" />
    <arg name="depth_topic" default="/$(arg robot_name)/dr/depth" />
    <arg name="pitch_topic" default="/$(arg robot_name)/dr/pitch" />

    <arg name="state_estimation_topic" default="/$(arg robot_name)/EstimatedPose" />

    <arg name="vbs_topic" default="/$(arg robot_name)/core/vbs_cmd" />

    <!-- Motion Planning Launch-->
    <arg name="waypoint_topic_arg" default="/waypoint_topic"/>
    <arg name="motion_plan_service_arg" default="/motion_plan_service"/>
    <arg name="state_topic_arg" default="sam/EstimatedPose"/>
    <arg name="base_frame_arg" default="sam/base_link/estimated"/>
    <arg name="docking_frame_arg" default="docking_station_planning"/>
    <arg name="map_frame_arg" default="map"/>
    <arg name="waypoint_marker_arg" default="/planner_node/waypoint_marker_topic"/>
    <arg name="found_station_arg" default="/found_station"/>


    <!-- Nodes -->
    <node pkg="sam_motion_planning" type="planner_class.py" name="planner_node" output="screen">
        <param name="waypoint_topic_name" value="$(arg waypoint_topic_arg)"/>
        <param name="waypoint_marker_topic" value="$(arg waypoint_marker_arg)"/>
        <param name="motion_plan_service_topic_name" value="$(arg motion_plan_service_arg)"/>
        <param name="state_topic_name" value="$(arg state_topic_arg)"/>

        <param name="base_frame_name" value="$(arg base_frame_arg)"/>
        <param name="docking_frame_name" value="$(arg docking_frame_arg)"/>
        <param name="map_frame_name" value="$(arg map_frame_arg)"/>
        <param name="found_station_name" value="$(arg found_station_arg)"/>
    </node>

    <!-- Control Launch-->
    <arg name="ref_pose_topic" default="$(arg waypoint_topic_arg)" />


    <!-- Nodes -->
    <!-- Ground truth for the estimate-->
    <!-- <node pkg="tf" type="static_transform_publisher" name="sam_static_tfm_ds"
        args="0.0 20.0 -1.5 0.0 0.0 0.0 map docking_station/base_link 20"/> -->

    <!-- <include file="smarc_navigation/sam_dead_reckoning/launch/sam_dr.launch" /> -->

    <!--Including tf_convenience topics-->
    <!-- <node name="odom_listener" pkg="tf_convenience_topics" type="odom_listener" output="screen" >
        <param name="odom_topic" value="/$(arg robot_name)/dr/odom"/>
        <param name="topic_from_dvl" value="$/(arg robot_name)/core/dvl"/>
        <param name="loop_freq" value="10" />
    </node> -->

    <node name="WaypointFollowingController" pkg="visual_feedback" type="WaypointFollowingController.py"
        output="screen" ns="$(arg robot_name)/ctrl">

        <param name="loop_freq" value="$(arg loop_freq)"/>
        <param name="verbose" value="$(arg verbose_arg)"/>

        <param name="ref_pose_topic" value="$(arg ref_pose_topic)" />

        <param name="state_feedback_topic" value="$(arg state_feedback_topic)" />
        <param name="depth_topic" value="$(arg depth_topic)" />
        <param name="pitch_topic" value="$(arg pitch_topic)" />
        <param name="state_estimation_topic" value="$(arg state_estimation_topic)" />
        <param name="vbs_topic" value="$(arg vbs_topic)" />
    </node>

</launch>
